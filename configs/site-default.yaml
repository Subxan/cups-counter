camera:
  source: "picamera2"          # "picamera2" or "gstreamer" or "opencv"
  index: 0
  width: 1280
  height: 720
  fps: 30
  rotate: 0

model:
  hef_path: "./models/yolov8n_coco.hef"
  class_filter: ["cup"]
  conf_thresh: 0.35
  iou_thresh: 0.45
  max_detections: 50
  mock_mode: false             # if true, generate fake cup detections for dev

tracking:
  type: "bytetrack"            # "bytetrack" or "ocsort"
  track_thresh: 0.50
  match_thresh: 0.80
  min_box_area: 150
  lost_ttl: 30                 # frames before a track is dropped

counting:
  line:
    start: [100, 360]
    end:   [1180, 360]
  direction: "bar_to_counter"  # invert if camera mirrored
  hysteresis_px: 6
  min_visible_frames: 3

storage:
  sqlite_path: "./data/cups.db"
  csv_dir: "./data/exports"
  export_daily_time: "23:59"   # HH:MM device local time
  wal_mode: true

ui:
  http_port: 8080
  preview: true
  draw_overlays: true
  timezone: "Asia/Baku"

ops:
  save_debug_video: false
  debug_dir: "./debug"
  metrics_port: 9109
  log_level: "INFO"

autocal:
  enabled: true
  warmup_seconds: 120             # build motion heatmap for 2 minutes
  propose_top_k: 3                # return best 3 line candidates
  auto_apply_if_confident: false  # true = apply without asking (use in lab)
  min_flow_ratio: 0.6             # dominant direction fraction to trust
  save_debug: true                # write debug heatmap/edges to ./debug

roi:
  enabled: true
  band_height_px: 140             # run detection near the line only
  margin_px: 24

drift:
  enabled: true
  ssim_threshold: 0.90            # below -> possible camera nudge
  edge_iou_threshold: 0.70
  brightness_var_min: 6.0         # glare/darkness alerts
  re_calibrate_on_drift: true
  min_minutes_between_recal: 60

tuner:
  enabled: true
  run_time: "03:10"               # daily local time
  clip_seconds: 90
  grid:
    conf_thresh: [0.30, 0.35, 0.40]
    match_thresh: [0.75, 0.80, 0.85]
    min_box_area: [120, 150, 180]
  optimize_for: "stable_crossings"  # or "min_double_counts"
  keep_best_profile: true

audit:
  thumbnails_per_day: 50          # lowest-confidence events
  thumb_size: [128, 128]

pos:
  recon_enabled: true
  pos_csv_dir: "./data/pos"

